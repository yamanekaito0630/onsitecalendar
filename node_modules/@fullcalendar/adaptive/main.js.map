{"version":3,"file":"main.js","sources":["src/main.ts"],"sourcesContent":["import {\n  createPlugin,\n  findElements,\n  flushSync,\n  CalendarContext,\n  removeExact,\n  config,\n} from '@fullcalendar/common'\n\nimport premiumCommonPlugin from '@fullcalendar/premium-common' // eslint-disable-line import/no-duplicates\n// ensure ambient declarations. TODO: remove?\nimport '@fullcalendar/premium-common' // eslint-disable-line import/no-duplicates\n\nimport './main.css'\n\nconfig.COLLAPSIBLE_WIDTH_THRESHOLD = 1200\n\nlet contexts: CalendarContext[] = []\nlet undoFuncs: (() => void)[] = []\n\nexport default createPlugin({\n  deps: [\n    premiumCommonPlugin,\n  ],\n  contextInit(context) {\n    if (!contexts.length) {\n      attachGlobalHandlers()\n    }\n    contexts.push(context)\n    context.calendarApi.on('_unmount', () => {\n      removeExact(contexts, context)\n      if (!contexts.length) {\n        removeGlobalHandlers()\n      }\n    })\n  },\n})\n\nfunction attachGlobalHandlers() {\n  window.addEventListener('beforeprint', handleBeforePrint)\n  window.addEventListener('afterprint', handleAfterPrint)\n\n  // // for testing\n  // let forPrint = false\n  // document.addEventListener('keypress', (ev) => {\n  //   if (ev.key === 'p') {\n  //     forPrint = !forPrint\n  //     if (forPrint) {\n  //       handleBeforePrint()\n  //     } else {\n  //       handleAfterPrint()\n  //     }\n  //   }\n  // })\n}\n\nfunction removeGlobalHandlers() {\n  window.removeEventListener('beforeprint', handleBeforePrint)\n  window.removeEventListener('afterprint', handleAfterPrint)\n}\n\nfunction handleBeforePrint() {\n  let scrollEls = queryScrollerEls()\n  let scrollCoords = queryScrollerCoords(scrollEls)\n\n  for (let context of contexts) {\n    context.emitter.trigger('_beforeprint')\n  }\n\n  flushSync(() => { // because printing grabs DOM immediately after\n    killHorizontalScrolling(scrollEls, scrollCoords)\n    undoFuncs.push(() => restoreScrollerCoords(scrollEls, scrollCoords))\n    undoFuncs.push(freezeScrollgridWidths())\n  })\n}\n\nfunction handleAfterPrint() {\n  for (let context of contexts) {\n    context.emitter.trigger('_afterprint')\n  }\n\n  flushSync(() => { // guarantee that there are real scrollers\n    while (undoFuncs.length) {\n      undoFuncs.shift()()\n    }\n  })\n}\n\n// scrollgrid widths\n\nfunction freezeScrollgridWidths() {\n  let els = findElements(document.body, '.fc-scrollgrid')\n  els.forEach(freezeScrollGridWidth)\n  return () => els.forEach(unfreezeScrollGridWidth)\n}\n\nfunction freezeScrollGridWidth(el: HTMLElement) {\n  let elWidth = el.getBoundingClientRect().width\n\n  // along with collapsibleWidth, this is a hack for #5707\n  if (!el.classList.contains('fc-scrollgrid-collapsible') || elWidth < config.COLLAPSIBLE_WIDTH_THRESHOLD) {\n    el.style.width = elWidth + 'px'\n  }\n}\n\nfunction unfreezeScrollGridWidth(el) {\n  el.style.width = ''\n}\n\n// scrollers\n// TODO: use scroll normalization!? yes\n\nfunction queryScrollerEls() {\n  return findElements(document.body, '.fc-scroller-harness > .fc-scroller')\n}\n\ninterface ScrollerCoords {\n  scrollLeft: number\n  scrollTop: number\n  overflowX: string\n  overflowY: string\n  marginBottom: string\n}\n\nfunction queryScrollerCoords(els: HTMLElement[]): ScrollerCoords[] {\n  return els.map((el) => {\n    let computedStyle = window.getComputedStyle(el)\n\n    return {\n      scrollLeft: el.scrollLeft,\n      scrollTop: el.scrollTop,\n      overflowX: computedStyle.overflowX,\n      overflowY: computedStyle.overflowY,\n      marginBottom: computedStyle.marginBottom,\n    }\n  })\n}\n\nfunction killHorizontalScrolling(els: HTMLElement[], coords: ScrollerCoords[]) {\n  els.forEach((el, i) => {\n    el.style.overflowX = 'visible' // need to clear X/Y to get true overflow\n    el.style.overflowY = 'visible' // \"\n    el.style.marginBottom = '' // for clipping away scrollbar. disable\n    el.style.left = -coords[i].scrollLeft + 'px' // simulate scrollLeft! will be position:relative\n  })\n}\n\nfunction restoreScrollerCoords(els: HTMLElement[], coords: ScrollerCoords[]) { // restores vertical scrolling too\n  els.forEach((el, i) => {\n    let c = coords[i]\n    el.style.overflowX = c.overflowX\n    el.style.overflowY = c.overflowY\n    el.style.marginBottom = c.marginBottom\n    el.style.left = ''\n    el.scrollLeft = c.scrollLeft\n    el.scrollTop = c.scrollTop\n  })\n}\n"],"names":[],"mappings":";;;;;;;;;;AAeA,MAAM,CAAC,2BAA2B,GAAG,IAAI,CAAA;AAEzC,IAAI,QAAQ,GAAsB,EAAE,CAAA;AACpC,IAAI,SAAS,GAAmB,EAAE,CAAA;AAElC,WAAe,YAAY,CAAC;IAC1B,IAAI,EAAE;QACJ,mBAAmB;KACpB;IACD,WAAW,YAAC,OAAO;QACjB,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;YACpB,oBAAoB,EAAE,CAAA;SACvB;QACD,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QACtB,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,EAAE;YACjC,WAAW,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAA;YAC9B,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;gBACpB,oBAAoB,EAAE,CAAA;aACvB;SACF,CAAC,CAAA;KACH;CACF,CAAC,CAAA;AAEF,SAAS,oBAAoB;IAC3B,MAAM,CAAC,gBAAgB,CAAC,aAAa,EAAE,iBAAiB,CAAC,CAAA;IACzD,MAAM,CAAC,gBAAgB,CAAC,YAAY,EAAE,gBAAgB,CAAC,CAAA;;;;;;;;;;;;;AAczD,CAAC;AAED,SAAS,oBAAoB;IAC3B,MAAM,CAAC,mBAAmB,CAAC,aAAa,EAAE,iBAAiB,CAAC,CAAA;IAC5D,MAAM,CAAC,mBAAmB,CAAC,YAAY,EAAE,gBAAgB,CAAC,CAAA;AAC5D,CAAC;AAED,SAAS,iBAAiB;IACxB,IAAI,SAAS,GAAG,gBAAgB,EAAE,CAAA;IAClC,IAAI,YAAY,GAAG,mBAAmB,CAAC,SAAS,CAAC,CAAA;IAEjD,KAAoB,UAAQ,EAAR,qBAAQ,EAAR,sBAAQ,EAAR,IAAQ,EAAE;QAAzB,IAAI,OAAO,iBAAA;QACd,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,cAAc,CAAC,CAAA;KACxC;IAED,SAAS,CAAC;QACR,uBAAuB,CAAC,SAAS,EAAE,YAAY,CAAC,CAAA;QAChD,SAAS,CAAC,IAAI,CAAC,cAAM,OAAA,qBAAqB,CAAC,SAAS,EAAE,YAAY,CAAC,GAAA,CAAC,CAAA;QACpE,SAAS,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC,CAAA;KACzC,CAAC,CAAA;AACJ,CAAC;AAED,SAAS,gBAAgB;IACvB,KAAoB,UAAQ,EAAR,qBAAQ,EAAR,sBAAQ,EAAR,IAAQ,EAAE;QAAzB,IAAI,OAAO,iBAAA;QACd,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,aAAa,CAAC,CAAA;KACvC;IAED,SAAS,CAAC;QACR,OAAO,SAAS,CAAC,MAAM,EAAE;YACvB,SAAS,CAAC,KAAK,EAAE,EAAE,CAAA;SACpB;KACF,CAAC,CAAA;AACJ,CAAC;AAED;AAEA,SAAS,sBAAsB;IAC7B,IAAI,GAAG,GAAG,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAA;IACvD,GAAG,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAA;IAClC,OAAO,cAAM,OAAA,GAAG,CAAC,OAAO,CAAC,uBAAuB,CAAC,GAAA,CAAA;AACnD,CAAC;AAED,SAAS,qBAAqB,CAAC,EAAe;IAC5C,IAAI,OAAO,GAAG,EAAE,CAAC,qBAAqB,EAAE,CAAC,KAAK,CAAA;;IAG9C,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,QAAQ,CAAC,2BAA2B,CAAC,IAAI,OAAO,GAAG,MAAM,CAAC,2BAA2B,EAAE;QACvG,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,OAAO,GAAG,IAAI,CAAA;KAChC;AACH,CAAC;AAED,SAAS,uBAAuB,CAAC,EAAE;IACjC,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,EAAE,CAAA;AACrB,CAAC;AAED;AACA;AAEA,SAAS,gBAAgB;IACvB,OAAO,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE,qCAAqC,CAAC,CAAA;AAC3E,CAAC;AAUD,SAAS,mBAAmB,CAAC,GAAkB;IAC7C,OAAO,GAAG,CAAC,GAAG,CAAC,UAAC,EAAE;QAChB,IAAI,aAAa,GAAG,MAAM,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAA;QAE/C,OAAO;YACL,UAAU,EAAE,EAAE,CAAC,UAAU;YACzB,SAAS,EAAE,EAAE,CAAC,SAAS;YACvB,SAAS,EAAE,aAAa,CAAC,SAAS;YAClC,SAAS,EAAE,aAAa,CAAC,SAAS;YAClC,YAAY,EAAE,aAAa,CAAC,YAAY;SACzC,CAAA;KACF,CAAC,CAAA;AACJ,CAAC;AAED,SAAS,uBAAuB,CAAC,GAAkB,EAAE,MAAwB;IAC3E,GAAG,CAAC,OAAO,CAAC,UAAC,EAAE,EAAE,CAAC;QAChB,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,SAAS,CAAA;QAC9B,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,SAAS,CAAA;QAC9B,EAAE,CAAC,KAAK,CAAC,YAAY,GAAG,EAAE,CAAA;QAC1B,EAAE,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,UAAU,GAAG,IAAI,CAAA;KAC7C,CAAC,CAAA;AACJ,CAAC;AAED,SAAS,qBAAqB,CAAC,GAAkB,EAAE,MAAwB;IACzE,GAAG,CAAC,OAAO,CAAC,UAAC,EAAE,EAAE,CAAC;QAChB,IAAI,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAA;QACjB,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,CAAA;QAChC,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,CAAA;QAChC,EAAE,CAAC,KAAK,CAAC,YAAY,GAAG,CAAC,CAAC,YAAY,CAAA;QACtC,EAAE,CAAC,KAAK,CAAC,IAAI,GAAG,EAAE,CAAA;QAClB,EAAE,CAAC,UAAU,GAAG,CAAC,CAAC,UAAU,CAAA;QAC5B,EAAE,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,CAAA;KAC3B,CAAC,CAAA;AACJ;;;;"}